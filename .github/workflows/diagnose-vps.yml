name: Diagnose VPS State

on:
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  diagnose:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check VPS Connection and State
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.VPS_HOST }}
        username: ${{ secrets.VPS_USERNAME }}
        key: ${{ secrets.VPS_SSH_KEY }}
        script: |
          echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ VPS —Å–µ—Ä–≤–µ—Ä–∞"
          echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $(whoami)"
          echo "–î–æ–º–∞—à–Ω—è—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $HOME"
          echo "–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"
          
          echo "\nüìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:"
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ /opt:"
          sudo ls -la /opt/ || echo "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ /opt"
          
          echo "\n–°–æ–¥–µ—Ä–∂–∏–º–æ–µ /var/www:"
          sudo ls -la /var/www/ || echo "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ /var/www"
          
          echo "\nüîß –ü—Ä–æ–≤–µ—Ä–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–æ–≤:"
          sudo systemctl list-units --type=service | grep career || echo "–°–µ—Ä–≤–∏—Å career –Ω–µ –Ω–∞–π–¥–µ–Ω"
          
          echo "\nüêç –ü—Ä–æ–≤–µ—Ä–∫–∞ Python:"
          python3 --version
          which python3
          
          echo "\nüåê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏:"
          curl -I http://localhost:8000/health || echo "API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
          
          echo "\nüìä –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:"
          df -h
          free -h
          
          echo "\n‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"